### 时间序列

时间序列分析(Time-Series Analysis)是指将原来的销售分解为四部分来看——趋势、周期、时期和不稳定因素， 然后综合这些因素， 提出销售预测。

ARIMA模型提供了基于时间序列理论，对数据进行平稳化处理（AR和MA过程）、模型定阶（自动差分过程）、参数估计，建立模型，并对模型进行检验。在Python中statsmodel提供了全套的解决方案，包括窗口选择、自动定阶和平稳性检测等等算法。

ARIMA模型（：Autoregressive Integrated Moving Average model），差分整合移动平均自回归模型，又称整合移动平均自回归模型（移动也可称作滑动），时间序列预测分析方法之一。ARIMA（p，d，q）中，AR是"自回归"，p为自回归项数；MA为"滑动平均"，q为滑动平均项数，d为使之成为平稳序列所做的差分次数（阶数）。“差分”一词虽未出现在ARIMA的英文名称中，却是关键步骤。
- **自回归模型AR**：自回归模型首先需要确定一个阶数p，表示用几期的历史值来预测当前值。p阶自回归模型的公式定义为:
  $$y_t=\mu +\sum_{i=1}^{p}\gamma_iy_{t-i}+\epsilon_t$$
  自回归模型有很多的限制：
  - 自回归模型是用自身的数据进行预测
  - 时间序列数据必须具有平稳性
  - 自回归只适用于预测与自身前期相关的现象
- **移动平均模型MA**：移动平均模型关注的是自回归模型中的误差项的累加 ，移动平均法能有效地消除预测中的随机波动。q阶自回归过程的公式定义如下:
  $$y_t=\mu +\sum_{i=1}^{q}\theta_i\epsilon_{t-i}+\epsilon$$
- **自回归移动平均模型ARMA**：自回归模型AR和移动平均模型MA模型相结合，我们就得到了自回归移动平均模型ARMA(p,q)，计算公式如下：
  $$y_t=\mu +\sum_{i=1}^{p}\gamma_iy_{t-i}+\sum_{i=1}^{q}\theta_i\epsilon_{t-i}+\epsilon$$
- **差分自回归移动平均模型ARIMA**：将自回归模型、移动平均模型和差分法结合，我们就得到了差分自回归移动平均模型ARIMA(p,d,q)，其中d是需要对数据进行差分的阶数。
- 时间序列建模流程![时间序列建模流程](/assets/timeseries.png)
- **拖尾和截尾**:拖尾指序列以指数率单调递减或震荡衰减，而截尾指序列从某个时点变得非常小.
出现以下情况，通常视为(偏)自相关系数d阶截尾：
1）在最初的d阶明显大于2倍标准差范围.
2）之后几乎95%的(偏)自相关系数都落在2倍标准差范围以内.
3）且由非零自相关系数衰减为在零附近小值波动的过程非常突然.
出现以下情况，通常视为(偏)自相关系数拖尾：
1）如果有超过5%的样本(偏)自相关系数都落入2倍标准差范围之外.
2）或者是由显著非0的(偏)自相关系数衰减为小值波动的过程比较缓慢或非常连续。
- **差分序列平稳性检测**。ADF检验总结一句话：如果序列是平稳的，则不存在单位根， 否则就会存在单位根。
- **自相关**（Autocorrelation），也叫序列相关，是一个信号于其自身在不同时间点的互相关。非正式地来说，它就是两次观察之间的相似度对它们之间的时间差的函数。它是找出重复模式（如被噪声掩盖的周期信号），或识别隐含在信号谐波频率中消失的基频的数学工具。自相关函数在不同的领域，定义不完全等效。在某些领域，自相关函数等同于自协方差。自相关函数ACF描述的是时间序列观测值与其过去的观测值之间的线性相关性。其中k代表滞后期数，如果k=2，则代表yt和yt-2。
$$ACF(K)=p_k=\frac{cov(y_t,y_{t-k})}{var(y_t)}$$
- **偏自相关函数PACF**：偏自相关函数用来度量暂时调整所有其他较短滞后的项 (y_{t-1}, y_{t-2}, ..., y_{t-k-1}) 之后，时间序列中以 k 个时间单位（y_{t}和y_{t-k}）分隔的观测值之间的相关。偏自相关是剔除干扰后时间序列观察与先前时间步长时间序列观察之间关系的总结。在滞后k处的偏自相关是在消除由于较短滞后条件导致的任何相关性的影响之后产生的相关性。一项观察的自相关和在先验时间步上的观测包括直接相关和间接相关。这些间接相关是线性函数观察（这个观察在两个时间步长之间）的相关。偏自相关函数试图移除这些间接相关。
- 模型的定阶问题主要是确定p，d，q三个参数。常用的信息准则函数法有下面几种：
  - 通过拖尾和截尾对模型进行定阶。p，q的确定基于如下的规则:      ![](/assets/ARIMA.jpg)
  - AIC准则全称为全称是最小化信息量准则（Akaike Information Criterion），计算公式如下：
$$AIC = =2 *（模型参数的个数）-2ln（模型的极大似然函数）$$
  - BIC（Bayesian InformationCriterion）贝叶斯信息准则弥补了AIC的不足（当样本容量很大时，在AIC准则中拟合误差提供的信息就要受到样本容量的放大，而参数个数的惩罚因子却和样本容量没关系（一直是2），因此当样本容量很大时，使用AIC准则选择的模型不收敛与真实模型），计算公式如下：
$$BIC = ln(n) * (模型中参数的个数) - 2ln(模型的极大似然函数值)，n是样本容量$$
